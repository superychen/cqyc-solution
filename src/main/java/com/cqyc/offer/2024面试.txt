
1、自我介绍
    面试官下午好，我叫杨晨，20年毕业于重庆工程学院，目前从事了4年的java开发工作经验，之前任职于史泰博中国以及永辉超市担任java开发工程师。
任职到现在，在永辉和史泰博主要负责得是B端供应链这一块，重点参与的项目有史泰博开放平台、VP中台，永辉采购中台这几个项目。
在史泰博任职期间，主要参与的有供应链数字化改造，协同平台功能建设，以及VP商品上下架构重建等。目前对史泰博B2B相关的一些业务，以及Java常用的技术、框架
都有一定的了解。平时闲暇的时候也会对目前流行的技术以及知识进行了解。

统一租户平台（账号管理，入驻管理，租户创建，租户权限管理）
统一开放平台（统一请求入口，请求鉴权管理，服务报文加解密，防爬虫，异常警告，限流管理，请求日志收集，请求统计）
统一数据推送平台（推送任务管理，任务自动重试，数据分页推送，推送文件生成，外部文件生成）
统一消息平台（消息管理，订阅管理，多集群订阅，消息栅栏，消息查询，异常重试）
统一大客户适配平台（动态脚本解析，硬编码路由，三方token维护，三方加解密，三方数据缓存，统一异常处理）
统一链路监控（请求监控，APM监控，资源监控，请求统计，业务告警，异常统计，日志管理）

消息平台快消息重试组件：
    探查调度器(查询重试数据，标记未执行状态，缓存msgID和延迟时间，并把当前时间当做score，放到redis的zset中)
    执行调度器：从redis中根据score获取一定数量的重试消息，这时开始进行推送，根据推送结果刷新缓存中的推送状态，推送次数。
    清理调度器：根据结果缓存在刷新缓存中的数据（因为不在同一个事务中，为了保证数据最终一致性，单独开启一个调度器）

消息平台：监听添加的topic、订阅关系表、快消息重试组件
vop适配平台：外部能力接进来，vop低代码组件：适配器模式（公共参数适配器，第三方认证适配器，脚本适配器，硬编码适配器）

2、项目介绍
 ###VP中台
     我这里负责VP中台的供应商中心 和 商品中心，这两个主要是一个面向供应商、合作伙伴、财务、商管用户所搭建的一个数字化平台。里面集成了供应商生命周期管理，合同管理，商品生命周期管理，向各个业务系统提供稳定的数据服务。比如供应商基础视图、商品采购视图等。
     商管在引入一个新商品时，引入流程也是数据生成审批流之后，通过MQ对接到流程引擎进行各个流程的状态扭转，经过各个部门审批后，数据上传至sap生成正式商品编码，最后下发至商品中间表，最后落地商品主数据中。包括商品基础信息，大区商品，货源信息，最终由canal读取mysql binlog中的数据，读取之后会同步到es中，然后提供商品的查询接口到各个域，这里es其实是做了一个宽表处理的，
 其实就是当成一个重点做数据搜索的数据库，然后再把一些热点供应商的商品key存储在redis中，至此一个商品信息就正式录入到永辉。
 在后续的订单操作中，我以一台办公笔记本为例，它在我们ADV商城或者门店中销售给对应的客户，当库存卖完了之后，需要补充对应货物的时候，这史泰博的采购经理会进行采购订单的需求，
 其中就包括供应商直送，或者物流配送，以及仓储调拨等方式进行。此时就会在OMS生成一个采购直送单，一系列处理之后，
 会通知到供应商进行订单发送，或者仓储中心进行补货，此时如果不是直送订单，供应商会发货到wms，此时wms进行验货入库，
 此时会调用到库存中心，进入库存更新，最后生成商品凭证，这个商品凭证回传到VP中台，此时一个订单正式生成完成，
 这个时候就会到OMS在发一个订货通知单，供应商可以在OMS查询对应的订货通知单。商品最后被客户前后完成后，即可进行关单处理。
 去年的史泰博采购订单营业额大约是在20个亿左右。

 在整个业务链中，开放平台主要作为一个对接门户做的，它其实就是将整个史泰博供应中台具备共享能力进行互联网方式的开放，供第三方调用。
 在开放平台能力全景中，主要分为统一租户平台、统一开放平台、统一数据推送平台、统一消息平台、以及大客户适配平台。
     我主要负责的就是统一数据推送平台、统一消息平台和VOP适配平台。
     数据推送平台主要内部能力是由大数据平台提供，将业务数据清理后，下发到平台业务中转表，然后通过丰富的推送方式将大数据那边抽取的数据推送给各个企业，
 其中包括推送邮政、国网以及政府企业各类的烟草、选品数据，因为各个企业推送方式和接收方式不同，所以通过策略模式将数据转换为http、xml、webService、
 ftp等数据格式进行推送。
     还有统一消息平台，目的就是将内部消息透出去，由管理员从管理平台中添加内部topic主题，--消息平台实现了多集群监听，监听sass、福利、adv商城等集群，
 然后维护一个topic订阅关系表，进行推送寻址，如果推送失败会进入重试表中，然后由快消息重试组件进行重试推送（分为探查调度器，执行调度器，清理调度器）。
 进行策略重试，分为按时间推送，还是按次数推送，如果一直失败后则进入死信队列。
     最后大客户适配平台其实是将外部接口能力接进来,内部业务调用第三方接口统一经过VOP平台，由VOP平台通过各种适配器将第三方的出参入参，以及请求头等信息封装
 成永辉内部能识别的参数，然后对第三方进行远程调用。整个的流程是第三方的配置请求在开放平台中台配置完成之后，更新到DB，然后MQ到VOP平台，然后VOP会更新到
 对应的服务，应用，api配置到redis缓存中。内部业务域接口需要调用第三方接口时，通过VOP平台，经过低代码组件中的各种适配器（公共参数适配器，第三方认证适配器，
 脚本适配器，硬编码处理器）处理之后,进行远程调用，然后对于返回的结果再由脚本适配器，定制的适配器做一些处理返回到内部业务域中。通知单。商品最后被客户前后完成后，即可进行关单处理。
去年的史泰博采购订单营业额大约是在20个亿左右。





##其他问题2：
1、假如给你一个需求，你首先会做什么
    01、需求可行性 02、需求的场景以及动机  03、解决了什么问题 04、需求未来能带来的收益
2、项目中遇到什么问题，怎么解决？
    1、vp商品中心两次mq消息堆积，
        01、第一次商品上下架中nacos生产配置域名错误（运维切换新域名，开发未及时修改，导致使用旧域名，接口调用失败），导致topic消息堆积。
            接入MQ告警策略，增加上线配置检查项。
        02、第二次堆积是接收商品价套下发，平常只有20万左右的价套数据，有一天突然下发139万，最终导致服务器遇到瓶颈，消费能力跟不上，最终积压。
        解决：事中：01、紧急扩容消费者，扩大消费速度。02、服务器扩容 03、topic队列扩容
             事后：01、消费线程动态线程池异步处理，并接入相关监控告警 02、POD节点超频配置提高
    2、商品查询服务19点-20点ES一直出现慢查询：
        skywalking服务告警es负载过高，查询对应商品PLU关系数据查询接口这段时间访问量达到200W+次，马上定位相应接口，发现调用链是从当天上线切换供应商，
            plu关系数据全量下发，引起40个线程并发查询200W次es。多次出现超20s+RT。影响到WMS那边查询和收货操作有相关影响，但无接口不可用。
        解决方案：01、下发时增加动态线程池优化。02、接口限频调用。03、wms调用接口不走es查询，从redis缓存接口出。
3、oom问题排查：
    一次线上sykwalking告警请求超时，同时线上GC耗时特别长，特别频繁。问题定位（拉取线上dump，发现hashMap占用了73的内存），发现有一个前两天上线的批量
       修改发票信息的接口，因为里面有一个递归的算法，导致内存不足。